<!DOCTYPE html>
<html>
  <head>
    <title>A little jQuery Mobile trick - The Philosopher Developer</title>
    <meta charset='utf-8' />
    <meta content='initial-scale=1.0, width=device-width, user-scalable=no' name='viewport' />
    <link href='/stylesheets/application.css' rel='stylesheet' />
    <link href='/stylesheets/pygments.css' rel='stylesheet' />
    <script src='http://w.sharethis.com/button/buttons.js' type='text/javascript'></script>
    <script src='/javascripts/ga.js' type='text/javascript'></script>
    <script src='/javascripts/shareThis.js' type='text/javascript'></script>
    <script src='/javascripts/jquery-1.9.1.min.js' type='text/javascript'></script>
    <script src='/javascripts/main.js' type='text/javascript'></script>
    <script type='text/javascript'>
      //<![CDATA[
        var disqus_shortname = "philosopherdeveloper";
        var disqus_title = "A little jQuery Mobile trick";
      //]]>
    </script>
    
  </head>
  <body>
    <header id='header'>
      <h1>
        <a href='/posts/little-jquery-mobile-trick.html'>A little jQuery Mobile trick</a>
      </h1>
      <h2><a href="/">the philosopher developer</a></h2>
    </header>
    <article>
  <header>
    <h1>
      July 25, 2011
      <span class='comments'><a href='#disqus_thread'></a></span>
      <script src='/javascripts/disqusCount.js' type='text/javascript'></script>
    </h1>
    <div class='social'>
      <span class='st_facebook_hcount' displayText='Facebook'></span>
      <span class='st_googleplus_hcount' displayText='Google+'></span>
      <span class='st_twitter_hcount' displayText='Tweet'></span>
      <span class='st_linkedin_hcount' displayText='LinkedIn'></span>
    </div>
  </header>
  <section class='content'>
    <p>I don’t really have anything revolutionary to share with the world at the moment, but I <strong>do</strong> want to get back into writing regular posts; so I figured I’d share a little <a href="http://jquerymobile.com/">jQuery Mobile</a> trick, since I’ve been using this library quite a bit lately for work.</p>

<p>Sometimes in JQM, you find that your page suddenly looks like garbage. Maybe you updated the data being displayed using a <a href="http://api.jquery.com/category/plugins/templates/">jQuery template</a>; or you rendered a form, navigated to a different page, then came back, and all of your JQM-provided styling mysteriously vanished.</p>

<p>You’re <a href="http://stackoverflow.com/questions/5249250">not alone</a>; this problem seems to have affected quite a few web developers out there in the wild, giving jQuery Mobile the ol’ college try.</p>

<p>Part of the problem here (which has driven more than a few of us to near-madness) is that the JQM team seem to have decided that calling <code>page()</code> on a jQuery object should… not actually <em>do</em> anything after the first time you call it. So maybe you tried adding a call to <code>page()</code> in your code, did your usual dance to reproduce the rendering problem, saw that everything was fine and thought, <em>Huzzah! All fixed!</em> And then the next day somehow you noticed the problem inexplicably resurface.</p>

<p>My <em>guess</em> is that JQM does this for optimization purposes, since JavaScript can be relatively expensive to run on mobile devices, especially those a generation or two back. So the developers figured, <em>Hey, if somebody calls <code>page()</code> multiple times, everything should already look fine after the first call; so we’ll just do him/her a favor and ignore subsequent calls!</em> Which… I don’t know. Honestly, I can imagine myself making the same (wrong, in my opinion) decision.</p>

<p><strong>Anyway</strong>, here’s the “trick” I promised: my coworkers and I found an <strong>ingenious</strong> solution to the “one <code>page()</code> call per DOM element” limitation: whatever item you want to re-render, to ensure all styles are applied properly by JQM, <strong>do this</strong>:</p>

<div class="highlight"><pre><span class="kd">function</span> <span class="nx">refreshStyles</span><span class="p">(</span> <span class="nx">$element</span> <span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">$wrapper</span> <span class="o">=</span> <span class="nx">$element</span><span class="p">.</span><span class="nx">wrap</span><span class="p">(</span> <span class="nx">$</span><span class="p">(</span> <span class="s2">"&lt;div&gt;"</span> <span class="p">)</span> <span class="p">);</span>
  <span class="nx">$wrapper</span><span class="p">.</span><span class="nx">page</span><span class="p">();</span>
  <span class="nx">$element</span><span class="p">.</span><span class="nx">unwrap</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p><strong>Edit 2011-Jul-29: <a href="/posts/jquery-mobile-trick-correction.html">The above snippet is wrong!</a></strong> Use the following instead:</p>

<div class="highlight"><pre><span class="kd">function</span> <span class="nx">refreshStyles</span><span class="p">(</span> <span class="nx">$element</span> <span class="p">)</span> <span class="p">{</span>
  <span class="nx">$element</span><span class="p">.</span><span class="nx">wrap</span><span class="p">(</span> <span class="s1">'&lt;div id="refresh-styles-wrapper"&gt;'</span> <span class="p">);</span>
  <span class="nx">$</span><span class="p">(</span><span class="s2">"#refresh-styles-wrapper"</span><span class="p">).</span><span class="nx">page</span><span class="p">();</span>
  <span class="nx">$element</span><span class="p">.</span><span class="nx">unwrap</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p><strong>(End edit.)</strong></p>

<p>In other words, <strong>wrap</strong> your element in a temporary DOM node that exists <em>only</em> for the purpose of calling <code>page()</code> and having it… you know, <em>do</em> something. Then just discard the wrapper completely.</p>

<p>Pretty clever, eh? (By the way, I have no idea what would happen if <code>$element</code> above comprised multiple jQuery objects. It’s <em>really</em> only meant for the case where you’re working with a single node. If you use it differently and get crazy results, don’t blame me!)</p>
    <div class='navigation'>
      <a class='previous' href='/posts/how-i-discovered-a-bug-in-the-csharp-compiler-part-2.html'>How I discovered a bug in the C# compiler, part 2</a>
      <a class='next' href='/posts/jquery-mobile-trick-correction.html'>About that jQuery Mobile trick: Correction</a>
    </div>
  </section>
  <section class='comments'>
    <div id='disqus_thread'></div>
    <script src='/javascripts/disqus.js' type='text/javascript'></script>
    <noscript>
      Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
    </noscript>
    <a class='dsq-brlink' href='http://disqus.com'>
      comments powered by
      <span class='logo-disqus'>Disqus</span>
    </a>
  </section>
</article>
    <footer>
      <ul class='menu'>
        <li><a href="/posts">All Posts</a></li>
        <li><a href="/about">About</a></li>
        <li>
          <a href='http://stackoverflow.com/users/105570' target='_blank'>
            <img alt='StackOverflow' src='/images/icons/stackoverflow-small.png' />
          </a>
        </li>
        <li>
          <a href='https://github.com/dtao' target='_blank'>
            <img alt='GitHub' src='/images/icons/github-small.png' />
          </a>
        </li>
        <li>
          <a href='https://twitter.com/dan_tao' target='_blank'>
            <img alt='Twitter' src='/images/icons/twitter-small.png' />
          </a>
        </li>
        <li>
          <a href='http://feeds.feedburner.com/philosopherdeveloper'>
            <img alt='RSS' src='/images/icons/rss-small.png' />
          </a>
        </li>
      </ul>
    </footer>
  </body>
</html>
