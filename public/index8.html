<!DOCTYPE html>
<html>
  <head>
    <title>The Philosopher Developer</title>
    <meta charset='utf-8' />
    <meta content='initial-scale=1.0, width=device-width, user-scalable=no' name='viewport' />
    <link href='/stylesheets/application.css' rel='stylesheet' />
    <link href='/stylesheets/pygments.css' rel='stylesheet' />
    <script src='http://w.sharethis.com/button/buttons.js' type='text/javascript'></script>
    <script src='/javascripts/ga.js' type='text/javascript'></script>
    <script src='/javascripts/shareThis.js' type='text/javascript'></script>
    <script src='/javascripts/jquery-1.9.1.min.js' type='text/javascript'></script>
    <!-- I've decided this isn't really worth doing until I make exceptions for -->
    <!-- sites that block iframes. -->
    <!-- %script(type="text/javascript" src="#{SITE_ROOT}/javascripts/main.js") -->
    
    <script type='text/javascript' src='/javascripts/posts.js'></script>
  </head>
  <body>
    <header id='header'>
      <h1><a href="/">The Philosopher Developer</a></h1>
      <h2>half-sound logic, half-decent code</h2>
    </header>
    <article class='abbreviated'>
  <header>
    <h1>
      <span class='title'>
        <a href='/posts/tempted-by-linq.html'>Tempted by LINQ? Stop and think</a>
      </span>
      <span class='date'>February 09, 2011</span>
    </h1>
  </header>
  <section class='content'>
    <p>LINQ is a really awesome tool for .NET developers, just like a hammer is a really awesome tool for a carpenter. But here’s the thing.</p>

<p>Sometimes I feel like, before LINQ, a .NET developer was akin to a carpenter without a hammer. And then the hammer came along, and carpenters the world over <em>totally</em> fell in love with it. It helped them get so many tasks done more quickly than they could before. But this led them to start using hammers in totally unintended ways.</p>

<p>These carpenters would attend meetings where they would ask questions like, “Does anyone know how to use a hammer as a level?” and “Who can show me how to tighten bolts using my hammer?” Some of the older carpenters at these meetings would shake their heads knowingly, while others would enthusiastically chime in with their clever and novel uses for hammers.</p>

<p>Guys, LINQ is just <strong>one tool</strong>. A carpenter wouldn’t use a hammer for every single task he needs to accomplish. Likewise, we should not be using this <em>one</em> feature of .NET to do everything having anything to do with collections within the language.</p>

<p>This is <em>particularly</em> important to me, because I work on code that must be high-performance all the time at work. I remember when I first introduced my teammates to LINQ; one developer on the team in particular got very excited and started using LINQ extension methods all over the place. For example we would find code like this:</p>

<div class="highlight"><pre><span class="k">For</span> <span class="k">Each</span> <span class="n">prod</span> <span class="ow">As</span> <span class="n">Product</span> <span class="ow">In</span> <span class="n">Products</span><span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">Function</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="n">p</span><span class="p">.</span><span class="n">IsQuoting</span><span class="p">).</span><span class="n">OrderBy</span><span class="p">(</span><span class="n">Function</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="n">p</span><span class="p">.</span><span class="n">Expiration</span><span class="p">).</span><span class="n">ThenBy</span><span class="p">(</span><span class="n">Function</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="n">p</span><span class="p">.</span><span class="n">Strike</span><span class="p">)</span>
    <span class="n">prod</span><span class="p">.</span><span class="n">SendQuotes</span><span class="p">()</span>
<span class="k">Next</span>
</pre></div>

<p>Yeah, that’s <em>terrible</em>. <strong>It’s like using a hammer to perform brain surgery.</strong> But how was my teammate to know, or even suspect there was anything wrong with what he was doing?</p>

<p>I think the .NET culture has embraced LINQ<span class="post-link">... (<a href="/posts/tempted-by-linq.html">read the full post</a>)</span></p>
  </section>
</article>
<article class='abbreviated'>
  <header>
    <h1>
      <span class='title'>
        <a href='/posts/multithreading-and-multitasking.html'>Multithreading and multitasking</a>
      </span>
      <span class='date'>February 04, 2011</span>
    </h1>
  </header>
  <section class='content'>
    <p>Watch the following video and count how many times the players in white pass the basketball. Then scroll down to read the rest of this post.</p>
    
    <p class="centered">.<br>.<br>.<br>.<br>.<br>.<br>.<br>.<br>.<br>.<br>.<br>.<br>.<br>.<br>.<br>.<br>.<br>.<br>.</p>
    
    <p><strong>Did you see the gorilla?</strong> OK, the truth is: <em>I</em> did, but only because I was expecting it (the name of the website where I first saw the video, <a href="http://www.theinvisiblegorilla.com/">The Invisible Gorilla</a>, kind of gives it away). Apparently a lot of viewers do <em>not</em> see the gorilla, though, because they are too busy focusing on the people throwing and catching the ball to notice it.</p>
    
    <p>It’s a fairly well-documented fact at this point that <a href="http://www.npr.org/templates/story/story.php?storyId=95256794">human beings are not so good at multitasking</a> (the fact that that link points to a 2-year-old article right there tells you that this is not news). Rather, we are very quick at <a href="http://en.wikipedia.org/wiki/Context_switching"><em>context-switching</em></a>.</p>
    
    <p>Those of you software engineers reading this: does that term sound familiar? I thought so. <strong>Context switching</strong> is the process of suspending and restoring the state of different <a href="http://en.wikipedia.org/wiki/Thread_%28computer_science%29"><em>threads</em></a> or <em>processes</em> on a single CPU. More simply, it is akin to shifting one’s attention back and forth between multiple things. A good example would be driving while talking on the phone. It’s actually impossible to pay attention to both simultaneously, according to neuroscientists; rather, what you are likely able to do when driving while talking is <em>switch</em> between thinking about your driving and thinking about your phone conversation, very rapidly:</p>
    
    <figure><img src="/images/context-switching.png" alt="An illustration of context switching between driving and talking"><figcaption>An illustration of context switching between driving and talking</figcaption></figure>
    
    <p>Computers are exactly like this too. This is becoming less true now that dual-core, quad-core, even six-core processors (this will likely only keep increasing) have become the norm, at least on desktop computers (and <em>especially</em> on servers, where 24 cores or more is not at<span class="post-link">... (<a href="/posts/multithreading-and-multitasking.html">read the full post</a>)</span></p>
  </section>
</article>
<article class='abbreviated'>
  <header>
    <h1>
      <span class='title'>
        <a href='/posts/terminating-condition.html'>Resolution: the need for a terminating condition</a>
      </span>
      <span class='date'>January 15, 2011</span>
    </h1>
  </header>
  <section class='content'>
    <p>For reasons not relevant to this blog, I have been thinking a lot lately about personal conflicts and how they evolve. In particular, my mind has been concentrating a great deal on the scenario of conflicts <em>escalating</em>: for example, the phenomenon where two people are having a regular conversation, and this somehow leads to a disagreement, and eventually the situation develops into an all-out shouting match with both parties so angry with each other that it’s often baffling to recall how the conversation began.</p>

<p>This can happen over a short or a long period of <strong>time</strong>. It can take place within a single ten-minute conversation; it can also span days, months, even <em>years</em> (in this case it might be the cause of a friendship’s disintegration). It can also occur on a small or large <strong>scale</strong>. It might occur between friends, families, communities, even <em>nations</em> (throughout history, what war has not started as a smaller disagreement that eventually grew to something much larger?). I think we’ve all seen it happen, sadly, probably numerous times.</p>

<p>As I am a software developer, I often perceive parallels between <em>real-world phenomena</em> and <em>software concepts</em>. What I want to do right now is to discuss one such parallel: the similarity between <strong>escalating conflict</strong> (the real-world phenomenon) and <strong>mutual recursion</strong> (the software concept).</p>

<p><strong>A note to those readers who aren’t programmers: I will be including some source code in this post, but don’t stop reading! I promise that this discussion is of a general nature and not strictly programming-related.</strong></p>

<p>For those who can read it, consider the following code snippet:</p>

<div class="highlight"><pre><span class="k">void</span> <span class="nf">Provoke</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">"Provoke!"</span><span class="p">);</span>
    <span class="n">Respond</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">void</span> <span class="nf">Respond</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">"Respond!"</span><span class="p">);</span>
    <span class="n">Provoke</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p>If I were to ask you, <em>What does the above code do?</em>, an initial response might be that<span class="post-link">... (<a href="/posts/terminating-condition.html">read the full post</a>)</span></p>
  </section>
</article>
<article class='abbreviated'>
  <header>
    <h1>
      <span class='title'>
        <a href='/posts/white-angels-and-black-devils.html'>White angels & black devils</a>
      </span>
      <span class='date'>January 01, 2011</span>
    </h1>
  </header>
  <section class='content'>
    <p>I hope everyone had a joyful time last night—but not <em>too</em> joyful, of course. I myself attended a party where the man who owned the house was showing everyone in attendance this M.C. Escher painting and asking him to name the <em>first</em> thing he saw:</p>

<figure><img src="/images/white-angels-and-black-devils.jpg" alt="Who doesnt see the devils first?"><figcaption>Who doesnt see the devils first?</figcaption></figure>

<p>Basically, everyone said “bats” (apparently they’re devils?). The man would then pull the picture away, say “Now look between the bats,” and show the picture again. On the second look, viewers would see the angels.</p>

<p>My big issue with this was: is this really so surprising? In our culture, by <em>default</em> white is a “background” color; just think of every single book you’ve ever read. The <em>pages</em> are white; the <em>text</em> (the <em>content</em>) is black. Or consider any black &amp; white picture. Is white not virtually <em>always</em> the background, with black representing the content? Our eyes are drawn—whether by nature or simply by convention, I can’t say, but drawn nevertheless—to the black part of a black &amp; white visual.</p>

<p>So I, personally, didn’t think it was that surprising. But I think it’s a really cool picture, just like everything else by Escher; and I’m glad the guy at the party was showing it to people.</p>

<p>That’s not what I wanted to write about today at all, though. Perhaps I’ll write another post soon to discuss what I originally meant to discuss in this one: an interesting realization I recently had, and how it relates to my New Year’s resolution.</p>
  </section>
</article>
<article class='abbreviated'>
  <header>
    <h1>
      <span class='title'>
        <a href='/posts/string-manipulation-in-net-epilogue.html'>String manipulation in .NET: Epilogue</a>
      </span>
      <span class='date'>June 04, 2010</span>
    </h1>
  </header>
  <section class='content'>
    <p>I’ve got a confession to make: I got a little carried away after <a href="/posts/are-strings-really-immutable-in-net.html">my last post</a>. In particular, I became somewhat obsessed with the following discovery: <strong>Not only can you manipulate strings in-place in .NET, you can do so without the <code>unsafe</code> switch, and without any performance penalty whatsoever (as would typically be associated with any form of reflection)</strong>.</p>

<p>Seriously? Yes.</p>

<p>There’s this little-known method in .NET (well, little-known to most developers who work on your run-of-the-mill business applications): <a href="http://msdn.microsoft.com/en-us/library/53cz7sc6.aspx"><code>Delegate.CreateDelegate</code></a>. What this method does, essentially, is provide direct access to a class method via a <code>MethodInfo</code> object, in the form of an appropriately-typed delegate.</p>

<p>In order to understand how this affects string manipulation in .NET, consider the fact that a <code>MethodInfo</code> object can represent <em>any</em> method: <strong>public or non-public</strong>.</p>

<p>In other words, this means you can access the <code>string.SetChar</code> method (totally private – remember, the <code>System.String</code> class was designed to be immutable) <em>directly</em>, without the performance hit of using reflection by calling <code>MethodInfo.Invoke</code>.</p>

<p>To illustrate how this can be done, take a look at this completely evil static helper class I wrote: <a href="https://gist.github.com/3371692">EvilStringHelper</a>.</p>

<p>The <code>EvilStringHelper</code> class provides an extension method on <code>string</code> called <code>ReverseInPlace</code>. This method does exactly what it sounds like.</p>

<p>Now, to illustrate how well this method performs, I thought I’d compare it to its most obvious legal analogue: <a href="http://msdn.microsoft.com/en-us/library/d3877932.aspx"><code>Array.Reverse</code></a> (on a <code>char[]</code> array).</p>

<p>Take a look:</p>

<div class="highlight"><pre><span class="k">class</span> <span class="nc">Program</span> <span class="p">{</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">N</span> <span class="p">=</span> <span class="m">10000</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">L</span> <span class="p">=</span> <span class="m">10</span><span class="p">;</span>

    <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">var</span> <span class="n">immutableStrings</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">string</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
        <span class="kt">var</span> <span class="n">mutableStrings</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">string</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
        <span class="kt">var</span> <span class="n">arrays</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">char</span><span class="p">[</span><span class="n">N</span><span class="p">][];</span>

        <span class="kt">var</span> <span class="n">rand</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Random</span><span class="p">();</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="p">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">var</span> <span class="n">s</span> <span class="p">=</span> <span class="n">GetRandomString</span><span class="p">(</span><span class="n">rand</span><span class="p">,</span> <span class="n">L</span><span class="p">);</span>

            <span class="n">immutableStrings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">=</span> <span class="n">s</span><span class="p">;</span>
            <span class="n">mutableStrings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">=</span> <span class="n">s</span><span class="p">;</span>
            <span class="n">arrays</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">=</span> <span class="n">s</span><span class="p">.</span><span class="n">ToCharArray</span><span class="p">();</span>
        <span class="p">}</span>
</pre></div><span class="post-link">... (<a href="/posts/string-manipulation-in-net-epilogue.html">read the full post</a>)</span>
  </section>
</article>
<div class='next-page'>
  <a href='/index9.html'>View older posts</a>
</div>
    <footer>
      <ul class='menu'>
        <li><a href="/posts">All Posts</a></li>
        <li><a href="/about">About</a></li>
        <li>
          <a href='http://stackoverflow.com/users/105570' target='_blank'>
            <img alt='StackOverflow' src='/images/icons/stackoverflow-small.png' />
          </a>
        </li>
        <li>
          <a href='https://github.com/dtao' target='_blank'>
            <img alt='GitHub' src='/images/icons/github-small.png' />
          </a>
        </li>
        <li>
          <a href='https://twitter.com/dan_tao' target='_blank'>
            <img alt='Twitter' src='/images/icons/twitter-small.png' />
          </a>
        </li>
        <li>
          <a href='http://feeds.feedburner.com/philosopherdeveloper'>
            <img alt='RSS' src='/images/icons/rss-small.png' />
          </a>
        </li>
      </ul>
    </footer>
  </body>
</html>
